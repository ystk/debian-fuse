From: Jann Horn <jannh@google.com>
Date: Sat, 14 Jul 2018 03:47:50 -0700
Subject: [4/5] fusermount: refuse unknown options
Origin: https://github.com/libfuse/libfuse/commit/5018a0c016495155ee598b7e0167b43d5d902414
Bug-Debian-Security: https://security-tracker.debian.org/tracker/CVE-2018-10906
Bug: https://github.com/libfuse/libfuse/pull/268

Blacklists are notoriously fragile; especially if the kernel wishes to add
some security-critical mount option at a later date, all existing systems
with older versions of fusermount installed will suddenly have a security
problem.
Additionally, if the kernel's option parsing became a tiny bit laxer, the
blacklist could probably be bypassed.

Whitelist known-harmless flags instead, even if it's slightly more
inconvenient.
---
 util/fusermount.c | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

Index: fuse-2.9.3/util/fusermount.c
===================================================================
--- fuse-2.9.3.orig/util/fusermount.c	2018-08-06 14:46:20.715825725 +0200
+++ fuse-2.9.3/util/fusermount.c	2018-08-06 14:46:20.703825725 +0200
@@ -822,10 +822,16 @@
 						flags |= flag;
 					else
 						flags  &= ~flag;
-				} else {
+				} else if (opt_eq(s, len, "default_permissions") ||
+					   opt_eq(s, len, "allow_other") ||
+					   begins_with(s, "max_read=") ||
+					   begins_with(s, "blksize=")) {
 					memcpy(d, s, len);
 					d += len;
 					*d++ = ',';
+				} else {
+					fprintf(stderr, "%s: unknown option '%.*s'\n", progname, len, s);
+					exit(1);
 				}
 			}
 		}
